# 记账网页应用架构总结

## 1. 应用概述
这是一个基于 Web 的个人记账应用，提供用户认证、收支记录、预算管理、数据可视化和数据导出等功能。

## 2. 技术栈

### 前端
- **HTML5**: 页面结构
- **JavaScript (Vanilla)**: 前端逻辑
- **Tailwind CSS**: 样式框架
- **Font Awesome**: 图标库
- **Chart.js**: 数据可视化

### 后端
- **Node.js**: 运行环境
- **Express.js**: Web 框架
- **SQLite**: 数据库

### 安全
- **bcrypt**: 密码哈希
- **express-session**: 会话管理
- **helmet**: 安全头部设置
- **rate-limit**: 请求频率限制
- **CORS**: 跨域资源共享

## 3. 系统架构

### 3.1 分层结构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│                 │    │                 │    │                 │
│   Frontend      │────►   Backend       │────►   Database     │
│ (HTML/JS/CSS)   │    │ (Express.js)    │    │ (SQLite)        │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 3.2 主要组件

#### 3.2.1 前端 (app.js)
前端主要负责:
- 用户界面渲染
- 表单处理
- API 请求
- 数据可视化
- 本地状态管理

核心功能:
- 交易记录 CRUD
- 预算管理
- 图表展示
- 数据导出 (CSV/Excel)
- 数据备份与恢复

#### 3.2.2 后端 (server.js)
后端主要负责:
- HTTP 服务器
- API 路由
- 数据库操作
- 用户认证
- 会话管理

核心功能:
- 用户注册/登录/登出
- 交易数据管理
- 预算数据管理
- AI 分析接口

#### 3.2.3 数据库 (SQLite)
包含三张主要表:
1. **users**: 用户信息
2. **transactions**: 交易记录
3. **budgets**: 预算设置

## 4. 数据流

### 4.1 用户认证流程
1. 用户提交登录/注册表单
2. 前端发送 API 请求到后端
3. 后端验证并处理请求
4. 后端设置会话 cookie
5. 前端根据响应更新状态

### 4.2 交易记录流程
1. 用户填写交易表单
2. 前端验证数据并发送 API 请求
3. 后端将数据写入数据库
4. 前端更新本地缓存和 UI
5. 重新渲染图表和统计信息

## 5. 安全设计

### 5.1 密码安全
- 使用 bcrypt 进行密码哈希
- 哈希过程添加随机盐

### 5.2 会话安全
- 使用 HTTP-only cookie 存储会话 ID
- 会话信息存储在 SQLite 中
- 支持生产环境下的 HTTPS

### 5.3 请求安全
- 使用 helmet 设置安全头部
- 限制 API 请求频率
- 配置 CORS 允许跨域请求
- 禁用浏览器缓存 API 响应

## 6. 扩展性

### 6.1 数据导出
支持导出为 CSV 和 Excel 格式，方便用户离线分析数据。

### 6.2 数据备份
支持一键备份和恢复数据，保障数据安全。

### 6.3 AI 分析
提供 AI 分析接口，可集成外部 AI 服务进行支出分析。

## 7. 文件结构

```
├── index.html      # 主页面
├── app.js          # 前端逻辑
├── styles.css      # 样式文件
├── server.js       # 后端服务器
├── accounts.db     # 数据库文件
├── sessions.db     # 会话数据库
└── package.json    # 项目依赖
```